name: trade-publisher-api
runtime: python
version: "3.9"

# Build configuration
build:
  commands:
    - pip install --upgrade pip
    - pip install -r requirements.txt

# Runtime configuration
run:
  command: gunicorn --bind 0.0.0.0:$PORT --workers 4 --timeout 120 app:app
  port: 5000

# Environment variables
env:
  DB_HOST: ${DB_HOST}
  DB_USER: ${DB_USER}
  DB_PASSWORD: ${DB_PASSWORD}
  DB_NAME: ${DB_NAME}
  DB_PORT: ${DB_PORT}
  API_KEY: ${API_KEY}
  SECRET_KEY: ${SECRET_KEY}
  FLASK_ENV: production

# Services
services:
  - type: mysql
    version: "8.0"
    name: trade-db

# Health check
health:
  path: /api/health
  port: 5000
  interval: 30s
  timeout: 10s
  retries: 3
  start_period: 60s

# Resource limits
resources:
  memory: 512Mi
  cpu: 0.5

# Scaling
scale:
  min: 1
  max: 3
  target_cpu: 70